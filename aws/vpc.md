---
description: Выжимка с документации что такое VPC и как с ним работать
---

# VPC

CIDR блок расчитывается как 2^\(32 - N\), где N - цифра после символа /.  
То есть подсеть /24 будет содержать 2^\(32-24\)=256 ipv4 адрес.  
VPC создается при создании аккаунта.  
Internet gateway - находится на network edge \(понятие, означающее что здесь находится сетевая граница предприятия и начинается сеть третьих сторон\)  
и служит точкой входа в интернет  
VPC создается одна на регион, в то время как подсети создаются одна на AZ.  
\(В 2018 году aws  не позволяла удалить дефолтный vpc, сейчас позволяет\).   
VPC и дефолтная VPC это разные вещи. Последнюю можно удалить и создать только с aws консоли.   
По умолчанию впц создается только с route table и dhcp options set.  
По умолчанию ec2 инстансы создаются с sg запрет на всё.  
  
Чтобы разрешить инстансам в впц только исходящий трафик, необходимо создать nat device и замапить его на множество приватных ип аддресов. nat device имеет свой собственный elastic ip.  
  
Соединить vpc со своей домашней или корпоративной сетью можно с помощью IPsec AWS Site-to-Site VPN соединения.  
  
У авс есть своя мировая сеть тир-1 \(network backbone\) через которую проходит весь траффик между регионами и АЗ.  
  
Публичная подсеть - подсеть имеющая доступ в интернет через  Internet gateway.   
Security group позволяет доступ в подсети только через указанные открытые порты и только для указанных протоколов.  
  
VPC peering - обьединение между собой различных vpc, находящихся в одном регионе \(интра-регион пиринг\) и в разных регионах \(интер-регион пиринг\).   
Используется вместе с AWS PrivateLink.  
В пиринговых соединениях нельзя использовать приватные DNS имена.  
Но можно создать приватную hosted zone на Route53 и назначить ее этим VPC.  
Размер VPC находится между /16 и /28.   
Адреса из RFC1918, то есть 172.х, 192.х, 10.х.  
Внезависимости из какой приватной подсети мы выберем адреса, 4 из них будут недоступны \(для всех CIDR блоков\):  
х.х.х.0 - сетевой адресс  
х.х.х.1- vpc роутер  
х.х.х.2 - dns сервер  
х.х.х.3 - зарезервирован на будущее  
х.х.х.255 - броадкаст. VPC не поддерживает броадкаст.  
  
Мы можем добавить к нашей VPC дополнительное количество диапазонов адресов \(cidr блоков\) в пределах квоты. Главное, чтобы они не пересекались.  
Мы не может к cidr блоку из одного диапазона rfc1918 \(скажем 172\) добавить cidr блок из другого диапазона \(скажем 192 или 10\).  
  
Весь траффик идет через internet gateway \(igw\). VPN траффик не идет через igw, а идет через virtual private gateway \(vpgw\).  
  
ACLs и SG могут работать вместе. SG контроллирует инстансы, ACLs контроллируют подсети.  
  
Записи в таблицу маршрутизации добавляются при создании дополнительных cidr блоков и назначении их нашей vpc.  
Все подсети имеют аттрибут, будут ли создаваемым в них инстансам назначатся публичные ip адресса.  
Публичные адреса мапятся на приватные посредством NAT.  
При старте каждый инстанс получает приватное и публичное  DNS имя.  
Публичное dns имя и разрешение имени можно отключить в настройках VPC.  
  
Flow log - захват информации о траффике с vpc, подсети или интерфейса и отправка в cloudwatch или s3. Flow логи не захватывают инфо с link-local адрессов и с зарезервированных адрессов \(см. выше\).  


